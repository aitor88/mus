<!DOCTYPE html>
<html lang="es" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>El Viaje del Ganchero</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400..700;1,400..700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Lora', serif;
            background-color: #1a1a1a;
            color: #333;
            overflow: hidden;
        }
        .game-container {
            background-color: #fdfdfd;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            display: flex;
            flex-direction: column;
            max-height: 100%;
            height: 100%;
        }
        .content-area {
            overflow-y: auto;
        }
        .choice-button {
            background-color: #333;
            border: 1px solid #333;
            color: #fff;
            transition: background-color 0.2s ease-out, color 0.2s ease-out;
        }
        .choice-button:hover {
            background-color: #fff;
            color: #333;
        }
        .iker-choice {
            background-color: #6B4F3A;
            border-color: #6B4F3A;
        }
        .iker-choice:hover {
            background-color: #fff;
            color: #6B4F3A;
        }
        .fade-in {
            animation: fadeIn 0.7s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .content-area::-webkit-scrollbar { width: 8px; }
        .content-area::-webkit-scrollbar-track { background: #f1f1f1; }
        .content-area::-webkit-scrollbar-thumb { background: #ccc; border-radius: 4px; }
        .content-area::-webkit-scrollbar-thumb:hover { background: #aaa; }
    </style>
</head>
<body class="h-full flex items-center justify-center p-2 md:p-4">

    <div id="game-container" class="game-container w-full max-w-2xl mx-auto rounded-lg overflow-hidden">
        <div id="content-wrapper" class="flex-grow flex flex-col"></div>
    </div>

    <script>
        const contentWrapper = document.getElementById('content-wrapper');
        let gameState = {};

        // --- GAME ENGINE ---
        function renderComponent(component) {
            contentWrapper.innerHTML = '';
            contentWrapper.appendChild(component);
        }

        function handleChoice(choice) {
            if (choice.action) {
                choice.action(gameState);
            }
            gameState.path.push(choice.id);
            const nextStageKey = choice.nextStage(gameState);
            renderStage(nextStageKey);
        }
        
        // --- UI COMPONENTS ---
        function createIntroComponent() {
            const container = document.createElement('div');
            container.className = 'p-8 text-center flex flex-col justify-center items-center h-full fade-in';
            container.innerHTML = `
                <img src="logo.png" alt="Logo del Juego" class="w-24 h-24 mb-4 mx-auto rounded-full shadow-md" onerror="this.style.display='none'">
                <h1 class="text-3xl md:text-4xl font-bold text-gray-800 mb-4">El Viaje del Ganchero</h1>
                <p class="text-gray-600 mb-8 max-w-md">Una vida marcada por el río. Cada decisión teje tu destino. Forja tu leyenda desde Albarracín hasta el mar.</p>
                <input type="text" id="character-name" placeholder="Tu nombre de ganchero..." class="w-full max-w-xs p-3 border border-gray-300 rounded-md mb-4 text-center focus:outline-none focus:ring-2 focus:ring-gray-800">
                <button id="start-button" class="choice-button w-full max-w-xs font-bold py-3 px-6 rounded-md text-lg">Comenzar</button>
            `;
            container.querySelector('#start-button').addEventListener('click', () => {
                const name = container.querySelector('#character-name').value.trim();
                gameState = {
                    name: name || "Ganchero",
                    reputation: 0,
                    wealth: 0,
                    injury: false,
                    navarreKnowledge: false,
                    relianceOnIker: 0,
                    path: []
                };
                renderStage('start');
            });
            return container;
        }

        function createStageComponent(stageKey) {
            const stage = gameData[stageKey];
            if (!stage) {
                return createEndingComponent();
            }

            const container = document.createElement('div');
            container.className = 'flex flex-col h-full';
            
            let choicesHTML = stage.choices.map((choice, index) => {
                if (choice.requires && !choice.requires(gameState)) return '';
                const buttonClass = choice.isIker ? 'iker-choice' : '';
                return `<button class="choice-button ${buttonClass} w-full text-left font-bold py-3 px-5 rounded-md" data-choice-index="${index}">${choice.text}</button>`;
            }).join('');

            container.innerHTML = `
                <div class="flex-shrink-0">
                    <img src="${stage.image}" alt="${stage.title}" class="w-full h-48 md:h-64 object-cover">
                </div>
                <div class="content-area p-6 md:p-8 flex-grow fade-in">
                    <h2 class="text-3xl md:text-4xl font-bold text-gray-800 mb-4">${stage.title}</h2>
                    <p class="text-gray-700 text-base md:text-lg leading-relaxed mb-8">${stage.text(gameState)}</p>
                    <div class="space-y-4">${choicesHTML}</div>
                </div>
            `;

            container.querySelectorAll('.choice-button').forEach(button => {
                button.addEventListener('click', (e) => {
                    const choiceIndex = parseInt(e.currentTarget.dataset.choiceIndex);
                    handleChoice(stage.choices[choiceIndex]);
                });
            });
            return container;
        }

        function createEndingComponent() {
            const ending = getEnding(gameState);
            const container = document.createElement('div');
            container.className = 'p-8 text-center flex flex-col justify-center items-center h-full fade-in';
            container.innerHTML = `
                <h1 class="text-3xl md:text-4xl font-bold text-gray-800 mb-4">${ending.title}</h1>
                <p class="text-gray-600 text-base md:text-lg leading-relaxed mb-8 max-w-md">${ending.text}</p>
                <button id="restart-button" class="choice-button w-full max-w-xs font-bold py-3 px-6 rounded-md text-lg">Vivir otra Vida</button>
            `;
            container.querySelector('#restart-button').addEventListener('click', () => renderComponent(createIntroComponent()));
            return container;
        }
        
        function renderStage(stageKey) {
            renderComponent(createStageComponent(stageKey));
        }

        // --- GAME DATA ---
        const gameData = {
            'start': {
                title: "La Promesa",
                image: "https://placehold.co/800x400/3A5F0B/ffffff?text=Sierra+de+Albarrac%C3%ADn",
                text: (gs) => `Naciste en la Sierra de Albarracín. Tu padre te enseñó el oficio. Tu madre, en su lecho final, te hizo una promesa: "Los troncos van al mar, ${gs.name}. Ve con ellos una vez. Ve el mar por mí". Con 15 años, te unes a tu primera maderada.`,
                choices: [
                    { id: 'a1', text: "Demostrar tu valía desde el primer día.", nextStage: () => 'atolladero', action: (gs) => gs.reputation++ },
                    { id: 'a2', text: "Aprender observando, sin llamar la atención.", nextStage: () => 'atolladero' }
                ]
            },
            'atolladero': {
                title: "El Atolladero",
                image: "https://placehold.co/800x400/4682b4/ffffff?text=El+Atolladero",
                text: (gs) => `En los "estrechos" de Villalba Baja, un nudo de troncos bloquea el cauce. El agua ruge. Los veteranos gritan. Es tu oportunidad para destacar o para ser prudente.`,
                choices: [
                    { id: 'b1', text: "Saltar al tronco clave para liberarlo.", nextStage: () => 'navarros', action: (gs) => { gs.reputation++; if(Math.random() < 0.3) gs.injury = true; } },
                    { id: 'b2', text: "Señalar el punto débil desde la orilla.", nextStage: () => 'navarros', action: (gs) => gs.wealth++ },
                ]
            },
            'navarros': {
                title: "El Encuentro Navarro",
                image: "https://placehold.co/800x400/964B00/ffffff?text=Almadieros+Navarros",
                text: (gs) => `Os encontráis con almadieros navarros. Su líder, Iker, os mira con sorna. "Vosotros bailáis con troncos sueltos", dice. "Nosotros domamos al río con balsas. Pero el río es el río". Decide viajar con vosotros un tramo para aprender del Turia.`,
                choices: [
                    { id: 'c1', text: "Compartir vuestro vino y escucharlo.", nextStage: () => 'paga', action: (gs) => gs.navarreKnowledge = true },
                    { id: 'c2', text: "Mantener las distancias. Es un extraño.", nextStage: () => 'paga' }
                ]
            },
            'paga': {
                title: "La Paga del Hambre",
                image: "https://placehold.co/800x400/D2B48C/000000?text=La+Paga",
                text: (gs) => `Día de paga. El representante del maderero os paga menos de lo acordado. Los demás callan por miedo. Iker, el navarro, te observa, esperando tu reacción.`,
                choices: [
                    { id: 'd1', text: "Reclamar lo que es justo, delante de todos.", nextStage: () => 'chelva', action: (gs) => { gs.reputation++; gs.wealth--; } },
                    { id: 'd2', text: "Callar. No buscas problemas.", nextStage: () => 'chelva' },
                    { id: 'd3', text: "Consultar a Iker, el navarro.", isIker: true, nextStage: () => 'paga_iker', requires: (gs) => gs.navarreKnowledge, action: (gs) => gs.relianceOnIker++ }
                ]
            },
            'paga_iker': {
                title: "El Consejo de Iker",
                image: "https://placehold.co/800x400/6B4F3A/ffffff?text=El+Consejo",
                text: (gs) => `Apartas a Iker. "En mi tierra", dice en voz baja, "un hombre solo que grita es un loco. Una cuadrilla entera que calla es un problema. No reclaméis a voces. Haced un plante silencioso. Dejad las herramientas en el suelo. El silencio asusta más que los gritos".`,
                choices: [
                    { id: 'di1', text: "Seguir su consejo. Organizar un plante silencioso.", nextStage: () => 'chelva', action: (gs) => { gs.reputation += 2; } },
                    { id: 'di2', text: "Agradecerle, pero reclamar a tu manera.", nextStage: () => 'chelva', action: (gs) => { gs.reputation++; gs.wealth--; } }
                ]
            },
            'chelva': {
                title: "La Hoz de Chelva",
                image: "https://placehold.co/800x400/8b4513/ffffff?text=La+Hoz+de+Chelva",
                text: (gs) => `Años después, eres un veterano. En Chelva, un capataz local os desafía a una carrera por la Hoz. El honor de vuestro pueblo está en juego.`,
                choices: [
                    { id: 'e1', text: "Aceptar. El honor lo es todo.", nextStage: () => 'azud', action: (gs) => gs.reputation++ },
                    { id: 'e2', text: "Proponer una apuesta con dinero.", nextStage: () => 'azud', action: (gs) => gs.wealth++ },
                    { id: 'e3', text: "Consultar a Iker, si aún viaja contigo.", isIker: true, nextStage: () => 'chelva_iker', requires: (gs) => gs.navarreKnowledge, action: (gs) => gs.relianceOnIker++ }
                ]
            },
            'chelva_iker': {
                title: "La Perspectiva Almadiera",
                image: "https://placehold.co/800x400/6B4F3A/ffffff?text=La+Perspectiva",
                text: (gs) => `Iker se ríe. "¿Honor? El honor es llevar toda la madera a su destino, no perder la mitad por ir rápido. Proponle un desafío de habilidad: la cuadrilla que llegue con menos troncos perdidos, gana. Eso es ser un hombre de río, no un corredor."`,
                choices: [
                    { id: 'ei1', text: "Proponer el desafío de habilidad.", nextStage: () => 'azud', action: (gs) => { gs.reputation++; gs.wealth++; } },
                    { id: 'ei2', text: "Ignorar su consejo y aceptar la carrera.", nextStage: () => 'azud', action: (gs) => gs.reputation++ }
                ]
            },
            'azud': {
                title: "El Azud de la Muerte",
                image: "https://placehold.co/800x400/708090/ffffff?text=El+Azud",
                text: (gs) => `Cerca de Pedralba, un azud amenaza la maderada. Alguien debe arriesgarse a guiar los troncos clave por la compuerta. Es una tarea casi suicida.`,
                choices: [
                    { id: 'f1', text: "Ofrecerte voluntario.", nextStage: (gs) => gs.navarreKnowledge ? 'carta' : 'final', action: (gs) => { gs.reputation++; if(Math.random() < 0.5) gs.injury = true; } },
                    { id: 'f2', text: "Esperar a que suba el caudal. Es más seguro.", nextStage: (gs) => gs.navarreKnowledge ? 'carta' : 'final', action: (gs) => gs.wealth-- }
                ]
            },
            'carta': {
                title: "La Carta de Navarra",
                image: "https://placehold.co/800x400/F5DEB3/000000?text=La+Carta",
                text: (gs) => `Recibes una carta de Iker. "Te he visto trabajar. Eres de los nuestros, aunque no lo sepas. Vente al Irati. Hay un futuro aquí para ti". El mar está cerca... pero esta es la oportunidad de tu vida.`,
                choices: [
                    { id: 'g1', text: "Ir a Navarra. Una nueva vida te espera.", nextStage: () => 'final' },
                    { id: 'g2', text: "Rechazar. Debes cumplir tu promesa.", nextStage: () => 'final' },
                ]
            }
        };
        
        // --- ENDINGS DATABASE ---
        const endings = [
            // Navarra Endings
            { condition: (gs) => gs.path.includes('g1') && gs.reputation > 2, title: "Maestro Almadiero del Irati", text: "Dejaste el Turia atrás. En Navarra, tu habilidad te convirtió en leyenda. Moriste anciano, respetado, con el sonido de los ríos pirenaicos como última canción de cuna." },
            { condition: (gs) => gs.path.includes('g1'), title: "Una Vida en el Norte", text: "Cambiaste el Turia por el Irati. La vida fue dura, pero buena. Formaste una familia, y aunque nunca viste el mar de tu madre, tus hijos crecieron escuchando historias de dos ríos." },
            
            // Iker Influence Endings
            { condition: (gs) => gs.relianceOnIker >= 2 && gs.reputation > 2, title: "Puente entre Ríos", text: "Llegaste al mar, pero tu mayor logro fue aprender. Fusionaste la agilidad del ganchero con la estrategia del almadiero, creando nuevas técnicas. Te convertiste en un maestro respetado en todas las cuencas, un hombre sabio que supo escuchar." },
            { condition: (gs) => gs.relianceOnIker >= 2, title: "La Sombra del Navarro", text: "Cumpliste tu promesa, pero siempre dudaste de tu instinto, apoyándote en Iker. Fuiste un buen ganchero, sí, pero en las tabernas se decía que tu leyenda le debía mucho a la sabiduría de un navarro." },
            
            // Injury Endings
            { condition: (gs) => gs.injury && gs.wealth < 0, title: "El Tullido de la Ribera", text: "El río te cobró su peaje. La lesión nunca sanó bien. Viste el mar, pero pasaste el resto de tus días con un dolor sordo, viviendo de la caridad y contando historias de cuando podías bailar sobre los troncos." },
            { condition: (gs) => gs.injury, title: "El Capataz Cojo", text: "La lesión te apartó del agua, pero no del negocio. Con lo que ahorraste, te convertiste en capataz. Viste el mar desde la comodidad de un carro, y aunque cojeabas, todos respetaban al hombre que había domado al río." },
            
            // Wealth & Reputation Endings
            { condition: (gs) => gs.wealth > 3 && gs.reputation > 3, title: "El Rey del Turia", text: "Llegaste a Valencia como un héroe y con los bolsillos llenos. Invertiste sabiamente, convirtiéndote en un poderoso maderero. Cumpliste tu promesa y compraste una casa desde donde se veía el mar cada mañana." },
            { condition: (gs) => gs.wealth > 3, title: "El Mercader Solitario", text: "Hiciste una fortuna, pero a costa de tu honor. En Valencia, tenías dinero, pero no amigos. Veías el mar desde un balcón dorado, pero sentías un vacío que ninguna riqueza podía llenar." },
            { condition: (gs) => gs.wealth < -2, title: "Miseria en la Huerta", text: "Llegaste a Valencia sin una moneda. El viaje te lo quitó todo. Cumpliste tu promesa, pero el mar solo te pareció un recordatorio de lo que habías perdido. Acabaste trabajando en la huerta, la espalda rota, el espíritu también." },
            { condition: (gs) => gs.reputation > 3, title: "La Leyenda del Ganchero Honrado", text: "No ganaste mucho dinero, pero te ganaste el respeto de todos. Tu nombre se convirtió en sinónimo de honor. Viste el mar, y ese fue tu tesoro. Volviste a la sierra, donde te recibieron como a un héroe." },
            { condition: (gs) => gs.reputation < -2, title: "El Desterrado", text: "Tu fama de problemático te precedió. Al llegar a Valencia, ningún capataz quiso contratarte. Viste el mar una vez, y luego desapareciste, una sombra odiada en las riberas del río." },

            // Default Ending
            { condition: 'default', title: "Un Ganchero Más", text: "Tu viaje terminó. Viste el mar, cumpliste tu promesa. Luego, volviste a la sierra y te uniste a la siguiente maderada. Y a la siguiente. Tu vida fue el río, un ciclo sin fin de madera y agua, una historia anónima grabada en la corriente del Turia." },
        ];

        function getEnding(gs) {
            for (const ending of endings) {
                if (ending.condition !== 'default' && ending.condition(gs)) {
                    return ending;
                }
            }
            return endings.find(e => e.condition === 'default');
        }

        // --- INITIALIZE APP ---
        renderComponent(createIntroComponent());
    </script>
</body>
</html>

